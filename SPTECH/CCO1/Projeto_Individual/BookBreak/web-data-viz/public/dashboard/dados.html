<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/icon_nav.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookBreak | Dados</title>

    <link rel="stylesheet" href="../css/explorar.css" />
    <script src="../js/sessao.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>

<!-- <body onload=" atualizarFeed()"> -->

<body onload="plotar()">

    <div class="janela">

            <header class="container">
                <div class="logo">
                    <div class="logo_txt">
                        <h3>Logado com: <span id="b_usuario">usuário</span></h3>
                    </div>
                </div>
                
                <div style="display: flex;">
                    <ul class="itensNaveBar">
                        <li> <a href="../explorar.html">Explorar</a></li>
                        <li>|</li>
                        <li> <a href="mural.html">Desafio Mensal</a></li>
                        <li>|</li>
                        <li> <a href="">Relatório</a></li>
                        <li>|</li>
                        <li onclick="limparSessao()">Sair</li>
                    </ul>
                </div>
            </header>

        
            <div class="correr">
                <div class="montante">
                    <div class="titulo" style="padding-top: 0; padding-bottom: 40px; width: 80%; margin-left: 10%;">
                        <div class="explorar">
                            <h1>Relatório</h1>
                        </div>
                        <div class="texto" style="text-align: center;">
                            <h2>Levantamento de dados para auxílio na administração da página</h2>
                        </div>
                    </div>

                    <div class="grafico">
                        <div>
                            <h4>Gêneros Favoritos dos leitores</h4> 
                              <div>
                                <canvas id="doughnut"></canvas>
                              </div>
                        </div>
                        <div>
                            <h4>Comentários ao longo do <br>Desafio Mensal</h4>  
                              <div>
                                <canvas id="coments" style="height: 200px;"></canvas>
                              </div>

                        </div>
                        
                    </div>
                    
                </div>
            </div>  

            
    </div>
    <div class="footer" id="contato">
                <div class="f1">
                    <h2>Entre em contato:</h2>
                </div>
                <div class="f2">
                </div>
            </div>


</body>

</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    // b_cpf.innerHTML = sessionStorage.CPF_USUARIO;
    


function plotar(){

    fetch("/avisos/plotar", {
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    acao = json.Acao;
                    ficcao = json.Ficcao;
                    romance = json.Romance;
                    terror = json.Terror;

                    console.log('os valores estão em: ', acao, ficcao, romance, terror);
                    

                    // <============= Grafico Donuts =============>


                    let dataD = {
                        labels: [
                            'Ação       .',
                            'Romance',
                            'Terror         .',
                            'Ficção.'
                        ],
                        datasets: [{
                            label: 'My First Dataset',
                            data: [acao, romance, terror, ficcao],
                            backgroundColor: [
                            '#4E3C30',
                            '#7E6D62',
                            '#AF988A',
                            '#9A7D48'
                            ],
                            hoverOffset: 4
                        }]
                        };

                    const configD = {
                        type: 'doughnut',
                        data: dataD,
                        options: {
                            responsive: true,
                            plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            title: {
                                display: false,
                                text: 'Chart.js Doughnut Chart'
                            }
                            }
                        },
                        };

                    const doughnut = new Chart(
                    document.getElementById('doughnut'),
                    configD
                    );

                });

                fetch("/avisos/plotarComent", {
                    }).then(function (resposta) {
                        console.log("ESTOU NO THEN DO entrar()!")

                   

                    resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                // <============= Grafico de Linha =============>

                    CP1 = json.C1;
                    CP2 = json.C2;
                    CP3 = json.C3;
                    CP4 = json.C4;
                    CP5 = json.C5;
                    CP6 = json.C6;
                    CP7 = json.C7;
                    CP8 = json.C8;
                    CP9 = json.C9;
                    CP10 = json.C10;
                    CP11 = json.C11;
                    CP12 = json.C12;
                    CP13 = json.C13;
                    CP14 = json.C14;
                    CP15 = json.C15;
                    CP16 = json.C16;
                    CP17 = json.C17;
                    CP18 = json.C18;
                    CP19 = json.C19;
                    CP20 = json.C20;
                    CP21 = json.C21;
                    CP22 = json.C22;
                    CP23 = json.C23;
                    CP24 = json.C24;
                    CP25 = json.C25;
                    CP26 = json.C26;
                    CP27 = json.C27;

                    console.log(CP1, CP2, CP3, CP4, CP5, CP6, CP7, CP8, CP9, CP10, CP11, CP12, CP13, CP14, CP15, CP16, CP17, CP18, CP19, CP20, CP21, CP22, CP23, CP24, CP25, CP26, CP27)
      

                    let dataL = {
                        labels: [
                            'Capítulo 1', 'Capítulo 2', 'Capítulo 3', 'Capítulo 4', 'Capítulo 5', 'Capítulo 6', 'Capítulo 7', 'Capítulo 8', 'Capítulo 9', 'Capítulo 10', 'Capítulo 11', 'Capítulo 12', 'Capítulo 13', 'Capítulo 14', 'Capítulo 15', 'Capítulo 16', 'Capítulo 17', 'Capítulo 18', 'Capítulo 19', 'Capítulo 20', 'Capítulo 21', 'Capítulo 22', 'Capítulo 23', 'Capítulo 24', 'Capítulo 25', 'Capítulo 26', 'Capítulo 27'
                        ],
                        datasets: [{
                            label: 'Comentários',
                            backgroundColor: '#4E3C30',
                            data: [CP1, CP2, CP3, CP4, CP5, CP6, CP7, CP8, CP9, CP10, CP11, CP12, CP13, CP14, CP15, CP16, CP17, CP18, CP19, CP20, CP21, CP22, CP23, CP24, CP25, CP26, CP27],
                        }], 
                        
                        };

                    const configL = {
                    type: 'line',
                    data: dataL,
                    options: {
                        responsive: true,
                        plugins: {

                        title: {
                            display: true,
                            position: 'bottom',
                            text: 'Número do Capítulo ->'
                        },
                        legend: {
                            position: 'bottom',
                            display: false,
                        }
                        
                        }
                    },
                    };

                    const comments = new Chart(
                    document.getElementById('coments'),
                    configL
                    );

                })
            });



            

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;





}

</script>